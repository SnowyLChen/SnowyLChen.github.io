---
title: 文件的上传与下载
date: 2019-11-03 12:24:23
tags: java
categories: java
---

# 1.多文件上传

```java
   /**
     * 多文件上传
     * @param multipartFiles
     * @param path
     * @return
     */
    public static List upLoads(MultipartFile[] multipartFiles, String path){
        List<String> Files=new ArrayList<>();
        String FilesPath="";
//       1.判断是否为空，不为空才上传
        if (multipartFiles!=null&&multipartFiles.length>0){
            System.out.println(multipartFiles.length);
            for (MultipartFile multipartFile:multipartFiles) {
                if (multipartFile!=null&&!multipartFile.isEmpty()){
//            2.获取文件名
                    String fileName=multipartFile.getOriginalFilename();
//            3.截取原文件前缀
                    String fileNamePrifix=fileName.substring(0,fileName.lastIndexOf("."));
//            4.给文件加上时间戳
                    String NewfileNamePrifix=fileNamePrifix+new Date().getTime();
//            5.给文件补充后缀
                    SimpleDateFormat df=new SimpleDateFormat("yyyy-MM-dd");
                    String fileDate = df.format(new Date());
                    String NewfileName=NewfileNamePrifix+fileName.substring(fileName.lastIndexOf("."));
//            6.构建新的文件
                    File file=new File(path+fileDate+File.separator+NewfileName);
//            7.上传
                    try {
                        //判断文件夹是否存在，不存在则创建
                        if (!file.exists()&& !file .isDirectory()){
                            file.mkdirs();
//                            if (!file.exists()) {
//                                file.createNewFile();
//                            }else {
//                                System.out.println("文件已存在");
//                            }
                        }
                        multipartFile.transferTo(file);
                        FilesPath=fileDate+File.separator+NewfileName;
                        Files.add(FilesPath);
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
            }
        }
        return Files;
    }
```

# 下载

```java
 /**
     * 文件下载
     * @param request
     * @param fileName
     * @return
     * @throws IOException
     */
    @RequestMapping("/download")
    public ResponseEntity<byte[]> download(HttpServletRequest request, String fileName) throws IOException {
        String realPath = request.getServletContext().getRealPath("/目录");
        File file = new File(realPath, fileName);
        String downloadFileName = new String(fileName.getBytes("UTF-8"), "UTF-8");
        HttpHeaders headers = new HttpHeaders();
        headers.setContentDispositionFormData("attachment", downloadFileName);
        headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);

        ApplicationContext ac=new ClassPathXmlApplicationContext("applicationContext.xml");
        fileService=ac.getBean("fileService",fileService.class);
        SimpleDateFormat simpleDateFormat=new SimpleDateFormat("yyyy-MM-dd");
        System.out.println(simpleDateFormat.format(new Date()));
        String filename= fileName;
        files f=new files();
        f.setName(filename.split("\\.")[0]);
        f.setTime(simpleDateFormat.format(new Date()));
        f.setType(filename.split("\\.")[1]);
        System.out.println(f);
        fileService.insert(f);

        return new ResponseEntity<byte[]>(FileUtils.readFileToByteArray(file), headers, HttpStatus.CREATED);

    }
```